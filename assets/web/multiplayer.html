<!DOCTYPE html>
<html>
<head>
    <title>Hangman</title>
</head>
<body>
<!-- websockets.html -->
<p id="status"></p>
<h1>Multiplayer</h1>
<p id="turn"></p>
<input id="input" type="text" />
<button id="button" onclick="send()">Send</button>
<p id="letters">Used letters : </p>
<p id="word"></p>
<p id="result"></p>
<button id="reset" style="visibility: hidden;" onclick="sendResetRequest()">reset</button>
<script>
    var playerTurn = document.getElementById("turn");
    var input = document.getElementById("input");
    var cword = document.getElementById("word");
    let letter = document.getElementById("letters");
    const socket = new WebSocket("ws://localhost:8080/multi/ws");


    socket.onopen = function () {
        console.log("Status: Connected\n");
        document.getElementById("status").innerHTML = "Connected";
        socket.send(": AskInfoSend");

    };

    socket.onclose = function(){
        console.log("Status: Disconected\n");
        document.getElementById("status").innerHTML = "Disconnected";
    };

    socket.onmessage = function (e) {
        var obj = JSON.parse(e.data);
        console.log(obj);
        if (obj.Type == "redirect"){
            document.location.href="/"+obj.Redirect;
        }else if (obj.Type == "datas")  {
            letter.innerHTML = "Used letters : "+ obj.Used;
            cword.innerHTML = obj.Word;
            if (obj.Turn){
                playerTurn.innerHTML = "Opponent turn";
            }else{
                playerTurn.innerHTML = "Your turn";
            }
            if (obj.Finish){
                input.style.visibility = "hidden";
                document.getElementById("button").style.visibility = "hidden";
                document.getElementById("reset").style.visibility = "visible";
                if (!obj.Turn){
                    document.getElementById("result").innerHTML = "You win !";
                }else{
                    document.getElementById("result").innerHTML = "You lose !";
                }
            }
        }
    };

    socket.onerror = error => {
        console.log("Socket Error: ", error);
    };

    function send() {
        socket.send(input.value);
        input.value = "";
    };

    function sendResetRequest(){
        socket.send(": ResetRequest");

    }
</script>
</body>
</html>
