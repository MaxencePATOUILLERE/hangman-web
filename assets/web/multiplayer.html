<!DOCTYPE html>
<html>
<head>
    <title>Hangman</title>
    <link href="http://localhost:8080/web/css/multiplayer.css" rel="stylesheet">
</head>
<body>
<!-- websockets.html -->
<div id="status_block">
    <p id="status"></p>
    <img id="connect_img" src="">
</div>
<h1>Multiplayer</h1>
<div id ="turnblock">
    <p id="turn"></p>
</div>
<div id="input_block">
    <input id="input" type="text" />
    <button id="button" onclick="send()">Send</button>
</div>
    <p id="letters">Used letters : </p>

<p id="word"></p>
<p id="result"></p>
<button id="reset" style="visibility: hidden;" onclick="sendResetRequest()">reset</button>
<script>
    var playerTurn = document.getElementById("turn");
    var input = document.getElementById("input");
    var cword = document.getElementById("word");
    let letter = document.getElementById("letters");
    const socket = new WebSocket("ws://localhost:8080/multi/ws");


    input.addEventListener("keyup", function(event) {
        if (event.keyCode === 13) {
            send();
        }
    });
    socket.onopen = function () {
        console.log("Status: Connected\n");
        document.getElementById("status").innerHTML = "Connected";
        socket.send(": AskInfoSend");
        document.getElementById("connect_img").src = "http://localhost:8080/web/images/connected.png";
    };

    socket.onclose = function(){
        console.log("Status: Disconected\n");
        document.getElementById("status").innerHTML = "Disconnected";
        document.getElementById("connect_img").src = "http://localhost:8080/web/images/unconnected.png";
    };

    socket.onmessage = function (e) {
        var obj = JSON.parse(e.data);
        console.log(obj);
        if (obj.Type == "redirect"){
            document.location.href="/"+obj.Redirect;
        }else if (obj.Type == "datas")  {
            letter.innerHTML = "Used letters : "+ obj.Used;
            cword.innerHTML = obj.Word;
            if (obj.Turn){
                playerTurn.innerHTML = "Opponent turn";
            }else{
                playerTurn.innerHTML = "Your turn";
            }
            if (obj.Finish){
                input.style.visibility = "hidden";
                document.getElementById("button").style.visibility = "hidden";
                document.getElementById("reset").style.visibility = "visible";
                if (!obj.Turn){
                    document.getElementById("result").innerHTML = "You win !";
                }else{
                    document.getElementById("result").innerHTML = "You lose !";
                }
            }
        }
    };

    socket.onerror = error => {
        console.log("Socket Error: ", error);
    };

    function send() {
        socket.send(input.value);
        input.value = "";
    };

    function sendResetRequest(){
        socket.send(": ResetRequest");

    }
</script>
</body>
</html>
