<!DOCTYPE html>
<html>
<head>
  <title>Hangman</title>
  <link href="http://localhost:8080/web/css/solo.css" rel="stylesheet">
</head>
<body>
<!-- websockets.html -->
<h1>Solo mode</h1>
<div id="status_block">
  <p id="status"></p>
  <img id="connect_img" src="">
</div>
<div id="attempts_block">
  <p id="attempts"></p>
  <p id="mort">mort</p>
</div>
<div id="input_block">
  <input id="input" type="text"/>
  <button id="button" onclick="send()">Send</button>
</div>
<p id="letters">Used letters : </p>
<p id="word"></p>
<button id="reset" style="visibility: hidden;" onclick="sendResetRequest()">reset</button>
<script>
  var input = document.getElementById("input");
  var cword = document.getElementById("word");
  var letter = document.getElementById("letters");
  var att = document.getElementById("attempts");
  var socket = new WebSocket("ws://localhost:8080/solo/ws");

  input.addEventListener("keyup", function(event) {
    if (event.keyCode === 13) {
      send();
    }
  });

  socket.onopen = function () {
    console.log("Status: Connected\n");
    document.getElementById("status").innerHTML = "Connected";
    document.getElementById("connect_img").src = "http://localhost:8080/web/images/connected.png";
    socket.send(": AskInfoSend")
  };

  socket.onclose = function(){
    console.log("Status: Disconected\n");
    document.getElementById("status").innerHTML = "Disconnected";
    document.getElementById("connect_img").src = "http://localhost:8080/web/images/unconnected.png";
  };

  socket.onmessage = function (e) {
    var obj = JSON.parse(e.data);
    if (obj.Type == "redirect"){
      document.location.href="/"+obj.Redirect;
    }else if (obj.Type == "datas") {
      letter.innerHTML = "Used letters : " + obj.Used;
      cword.innerHTML = obj.Word;
      att.innerHTML = obj.Attempts;
      if (obj.Finish) {
        input.style.visibility = "hidden";
        document.getElementById("reset").style.visibility = "visible";
        document.getElementById("button").style.visibility = "hidden";
      }
    }
  };

  function send() {
    socket.send(input.value);
    input.value = "";
  }

  function sendResetRequest(){
    socket.send(": ResetRequest");
  }
</script>
</body>
</html>
